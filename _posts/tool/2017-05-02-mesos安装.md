---
layout: post  
title: "mesos安装"
date: 2017-05-02
author: hunterhug
desc: "mesos安装"
categories: [代码]
tags: ["mesos"]
permalink: "/tool/mesos-install.html"
--- 

[mesos入门介绍](http://blog.csdn.net/lsshlsw/article/details/47086869)

# docker方式安装

以下为ubuntu操作系统，参考：http://www.open-open.com/lib/view/open1421195966031.html

配置本机IP：127.0.0.1
```
jinhan@jinhan-chen-110:~$ HOST_IP=127.0.0.1
jinhan@jinhan-chen-110:~$ echo $HOST_IP
127.0.0.1
```

## zookeeper

1.手动build镜像安装zookeeper

https://github.com/jplock/docker-zookeeper

```
FROM openjdk:8-jre-alpine
MAINTAINER Justin Plock <justin@plock.net>

ARG MIRROR=http://apache.mirrors.pair.com
ARG VERSION=3.4.10

LABEL name="zookeeper" version=$VERSION

RUN apk add --no-cache wget bash \
    && mkdir -p /opt/zookeeper \
    && wget -q -O - $MIRROR/zookeeper/zookeeper-$VERSION/zookeeper-$VERSION.tar.gz \
      | tar -xzC /opt/zookeeper --strip-components=1 \
    && cp /opt/zookeeper/conf/zoo_sample.cfg /opt/zookeeper/conf/zoo.cfg \
    && mkdir -p /tmp/zookeeper

EXPOSE 2181 2888 3888

WORKDIR /opt/zookeeper

VOLUME ["/opt/zookeeper/conf", "/tmp/zookeeper"]

ENTRYPOINT ["/opt/zookeeper/bin/zkServer.sh"]
CMD ["start-foreground"]
```

构建镜像
```
sudo docker build -t jinhan/zookeeper:3.4.10 .
```

2.使用别人做好的zookeeper镜像

```
sudo docker pull garland/zookeeper
```

3.启动

```
sudo docker run -d \
-p 2181:2181 \
-p 2888:2888 \
-p 3888:3888 \
garland/zookeeper


# 进入容器测试zk
sudo docker exec -i -t  18d71ccb9b0b /bin/bash

./zkCli.sh -server 127.0.0.1:2181
ls /

```

## mesos-master

1.拉取镜像
```
sudo docker pull garland/mesosphere-docker-mesos-master
```

2.跑master
```
sudo docker run --net="host" \
-p 5050:5050 \
-e "MESOS_HOSTNAME=${HOST_IP}" \
-e "MESOS_IP=${HOST_IP}" \
-e "MESOS_ZK=zk://${HOST_IP}:2181/mesos" \
-e "MESOS_PORT=5050" \
-e "MESOS_LOG_DIR=/var/log/mesos" \
-e "MESOS_QUORUM=1" \
-e "MESOS_REGISTRY=in_memory" \
-e "MESOS_WORK_DIR=/var/lib/mesos" \
-d \
garland/mesosphere-docker-mesos-master
```

3.跑slave
```
sudo docker run --net="host" -d \
--name mesos_slave_1 \
--entrypoint="mesos-slave" \
-e "MESOS_MASTER=zk://${HOST_IP}:2181/mesos" \
-e "MESOS_LOG_DIR=/var/log/mesos" \
-e "MESOS_LOGGING_LEVEL=INFO" \
garland/mesosphere-docker-mesos-master
```

## marathon

1.拉取镜像
```
sudo docker pull garland/mesosphere-docker-marathon
```

2.跑

不加host会连不上zk

```
指定方法：--net="host"
这种创建出来的容器，可以看到host上所有的网络设备。
容器中，对这些设备（比如DUBS）有全部的访问权限。因此docker提示我们，这种方式是不安全的。
```

```
sudo docker run --net="host" -d -p 8080:8080 \
garland/mesosphere-docker-marathon --master zk://${HOST_IP}:2181/mesos --zk zk://${HOST_IP}:2181/marathon
```

## Web界面

1. Mesos界面

```
http://${HOST_IP}:5050
```

2. Marathon界面

```
http://${HOST_IP}:8080
```

新建APP ：echo "1" >> /tmp/output.txt


进容器
```
sudo docker exec -it mesos_slave_1 /bin/bash
tail -f /tmp/output.txt
```
